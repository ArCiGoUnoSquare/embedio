<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="EmbedIO Webserver">

        <!-- CSS (from CDN) -->
        <link rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.4/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//cdn.jsdelivr.net/fontawesome/4.3.0/css/font-awesome.min.css" />
        <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.4/lumen/bootstrap.min.css" rel="stylesheet">
        <link href="//cdn.jsdelivr.net/highlight.js/8.5.0/styles/github.min.css" rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">

        <!--[if lt IE 9]>
            <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- JS (from CDN) -->
        <script src="//cdn.jsdelivr.net/g/jquery,bootstrap"></script>
        <script src="//cdn.jsdelivr.net/highlight.js/8.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <!-- Favicons -->
        <link rel="icon" href="favicon.ico" />

        <title>EmbedIO - A tiny, cross-platform, module based web server by unosquare</title>
    </head>

    <body>
        <div id="wrapper">
            <header class="navbar navbar-static-top" id="top" role="banner">
                <div class="container">
                    <div class="navbar-header">
                        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                            <i class="fa fa-bars"></i>
                        </button>
                        <a href="/embedio/" class="navbar-brand">
                            <img src="images/embedio-icon.png" alt="Tubular" style="height: 38px; margin-top: -12px" />
                        </a>
                    </div>
                    <nav class="collapse navbar-collapse bs-navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="#features">Features</a></li>
                            <li><a href="#nuget">NuGet Installation</a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">
                                    Examples<span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#basic">Basic Example</a></li>
                                    <li><a href="#rest">REST API Example</a></li>
                                    <li><a href="#websocket">Web Sockets Example</a></li>
                                </ul>
                            </li>
                            <li><a href="#cli">EmbedIO CLI</a></li>
                            <li><a href="doc/index.html">Documentation</a></li>
                            <li><a href="/embedio-extras/">Extras</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="http://github.com/unosquare/embedio">EmbedIO @ GitHub</a></li>
                            <li><a href="http://www.unosquare.com">Unosquare</a></li>
                            <li><a href="http://unosquare.github.io/">Labs @ GitHub</a></li>
                        </ul>
                    </nav>
                </div>
            </header>
            <div class="content-body">
                <div class="jumbotron">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-4 col-xs-12">
                                <div class="text-center">
                                    <img src="images/embedio.png" alt="EmbedIO" />
                                </div>
                            </div>
                            <div class="col-md-8 col-xs-12">
                                <h1 class="hidden-sm hidden-xs">EmbedIO</h1>
                                <h2>A tiny, cross-platform, module based web server</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <section id="main_content">
                        <h2 id="features">Features:</h2>

                        <ul>
                            <li>Network operations use the relatively recent async/await pattern.</li>
                            <li>Cross-platform (tested in <a href="http://www.mono-project.com/" target="_blank">Mono</a> 3.10.x on Windows and on a custom Yocto image for the Raspberry Pi)</li>
                            <li>
                                Extensible (Write your own modules. For example, video streaming, UPnP, etc.). Check
                                <a href="https://github.com/unosquare/embedio-extras" target="_blank">EmbedIO Extras</a> for more
                                modules.
                            </li>
                            <li>Small memory footprint</li>
                            <li>Create REST APIs quickly with out-of-the-box Web Api module</li>
                            <li>Serve static files with 1 line of code (also out-of-the-box)</li>
                            <li>Handle sessions with the built-in LocalSessionWebModule</li>
                            <li>Web Sockets support (Not available on Mono though)</li>
                            <li>CORS support. Origin, Headers and Methods validation with OPTIONS preflight</li>
                            <li>Supports HTTP 206 Partial Content</li>
                            <li>
                                <a href="http://owin.org/">OWIN</a> Middleware support via <a href="https://github.com/unosquare/embedio-extras/tree/master/Unosquare.Labs.EmbedIO.OwinMiddleware">Owin Middleware Module</a>.
                            </li>
                        </ul>

                        <p>
                            <em>
                                For detailed usage and REST API implementation, download the
                                code and take a look at the <a href="https://github.com/unosquare/embedio/tree/master/Unosquare.Labs.EmbedIO.Samples">Samples project</a>.
                            </em>
                        </p>
                        <hr />
                        <h2 id="nuget">NuGet Installation:</h2>

                        <div class="row">
                            <div class="col-md-8"><pre><code>PM&gt; Install-Package EmbedIO</code></pre></div>
                            <div class="col-md-4 text-center">
                                <a href="http://badge.fury.io/nu/embedio"><img src="https://badge.fury.io/nu/embedio.svg" alt="NuGet version" height="18"></a>
                            </div>
                        </div>
                        <hr />
                        <h2 id="basic">Basic Example:</h2>

                        <p><em>Please note the comments are the important part here. More info is available in the samples.</em></p>

                        <pre><code class="csharp">namespace Company.Project
{
    using System;
    using Unosquare.Labs.EmbedIO;                                 
    using Unosquare.Labs.EmbedIO.Log;
    class Program
    {
        /// &lt;summary&gt;
        /// Defines the entry point of the application.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;args&quot;&gt;The arguments.&lt;/param&gt;
        static void Main(string[] args)
        {
            var url = &quot;http://localhost:9696/&quot;;
            if (args.Length &gt; 0)
                url = args[0];
            // Our web server is disposable. Note that if you don&#39;t want to use logging,
            // there are alternate constructors that allow you to skip specifying an ILog object.
            using (var server = new WebServer(url, new SimpleConsoleLog()))
            {
                // First, we will configure our web server by adding Modules.
                // Please note that order DOES matter.
                // ================================================================================================
                // If we want to enable sessions, we simply register the LocalSessionModule
                // Beware that this is an in-memory session storage mechanism so, avoid storing very large objects.
                // You can use the server.GetSession() method to get the SessionInfo object and manupulate it.
                // You could potentially implement a distributed session module using something like Redis
                server.RegisterModule(new Modules.LocalSessionModule());
                // Here we setup serving of static files
                server.RegisterModule(new Modules.StaticFilesModule(&quot;c:/inetpub/wwwroot&quot;));
                // The static files module will cache small files in ram until it detects they have been modified.
                server.Module&lt;modules.staticfilesmodule&gt;().UseRamCache = true;
                server.Module&lt;modules.staticfilesmodule&gt;().DefaultExtension = &quot;.html&quot;;
                // We don&#39;t need to add the line below. The default document is always index.html.
                //server.Module&lt;modules.staticfileswebmodule&gt;().DefaultDocument = &quot;index.html&quot;;
                // Once we&#39;ve registered our modules and configured them, we call the RunAsync() method.
                // This is a non-blocking method (it return immediately) so in this case we avoid
                // disposing of the object until a key is pressed.
                //server.Run();
                var cts = new CancellationTokenSource();
                var task = server.RunAsync(cts);
                // Fire up the browser to show the content if we are debugging!
#if DEBUG
                var browser = new System.Diagnostics.Process() { 
                    StartInfo = new System.Diagnostics.ProcessStartInfo(url) { UseShellExecute = true } };
                browser.Start();
#endif
                // Wait for any key to be pressed before disposing of our web server.
                // In a service we&#39;d manage the lifecycle of of our web server using
                // something like a BackgroundWorker or a ManualResetEvent.
                Console.ReadKey(true);
            }
        }
    }
}</code></pre>
                        <hr />
                        <h2>Fluent Example:</h2>
                        <pre><code class="csharp">
namespace Company.Project
{
    using System;
    using Unosquare.Labs.EmbedIO;
    internal class Program
    {
        /// &lt;summary&gt;
        /// Defines the entry point of the application.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;args&quot;&gt;The arguments.&lt;/param&gt;
        private static void Main(string[] args)
        {
            var url = &quot;http://localhost:9696/&quot;;
            if (args.Length &gt; 0)
                url = args[0];
            // Create Webserver with console logger and attach LocalSession and Static
            // files module
            var server = WebServer
                .CreateWithConsole(url)                                 
                .EnableCors()
                .WithLocalSession()
                .WithStaticFolderAt(&quot;c:/web&quot;);
            server.RunAsync();
            // Fire up the browser to show the content if we are debugging!
#if DEBUG
            var browser = new System.Diagnostics.Process()
            {
                StartInfo = new System.Diagnostics.ProcessStartInfo(url) {UseShellExecute = true}
            };
            browser.Start();
#endif
            // Wait for any key to be pressed before disposing of our web server.
            // In a service we&#39;d manage the lifecycle of of our web server using
            // something like a BackgroundWorker or a ManualResetEvent.
            Console.ReadKey(true);
            server.Dispose();
        }
    }
}
</code></pre>
                        <hr />
                        <h2 id="rest">REST API Example:</h2>

                        <p><em>During server setup:</em></p>

                        <pre><code class="csharp">server.RegisterModule(new WebApiModule());
server.Module&lt;WebApiModule&gt;().RegisterController&lt;PeopleController&gt;();</code></pre>

                        <p><em>And our controller class looks like:</em></p>

                        <pre><code class="csharp">public class PeopleController : WebApiController
{
    [WebApiHandler(HttpVerbs.Get, "/api/people/*")]
    public bool GetPeople(WebServer server, HttpListenerContext context)
    {
        try
        {
            var lastSegment = context.Request.Url.Segments.Last();
            if (lastSegment.EndsWith("/"))
                return context.JsonResponse(People);
            int key = 0;
            if (int.TryParse(lastSegment, out key) && People.Any(p => p.Key == key))
            {
                return context.JsonResponse(People.FirstOrDefault(p => p.Key == key));
            }
            throw new KeyNotFoundException("Key Not Found: " + lastSegment);
        }
        catch (Exception ex)
        {
            return HandleError(context, ex, (int)HttpStatusCode.InternalServerError);
        }
    }
    protected bool HandleError(HttpListenerContext context, Exception ex, int statusCode = 500)
    {
        var errorResponse = new
        {
            Title = "Unexpected Error",
            ErrorCode = ex.GetType().Name,
            Description = ex.ExceptionMessage(),
        };
        context.Response.StatusCode = statusCode;
        return context.JsonResponse(errorResponse);
    }
}</code></pre>
                        <hr />
                        <h2 id="websocket">Web Sockets Example:</h2>
                        <p><em>During server setup:</em></p>

                        <pre><code class="csharp">server.RegisterModule(new WebSocketsModule());
server.Module&lt;WebSocketsModule&gt;().RegisterWebSocketsServer&lt;WebSocketsChatServer&gt;(&quot;/chat&quot;);</code></pre>

                        <p><em>And our web sockets server class looks like:</em></p>
                        <pre><code class="csharp">/// &lt;summary&gt;
/// Defines a very simple chat server
/// &lt;/summary&gt;
public class WebSocketsChatServer : WebSocketsServer
{
    public WebSocketsChatServer()
        : base(true, 0)
    {
        // placeholder
    }
    /// &lt;summary&gt;
    /// Called when this WebSockets Server receives a full message (EndOfMessage) form a WebSockets client.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;The context.&lt;/param&gt;
    /// &lt;param name=&quot;rxBuffer&quot;&gt;The rx buffer.&lt;/param&gt;
    /// &lt;param name=&quot;rxResult&quot;&gt;The rx result.&lt;/param&gt;
    protected override void OnMessageReceived(WebSocketContext context, byte[] rxBuffer, WebSocketReceiveResult rxResult)
    {
        var session = this.WebServer.GetSession(context);
        foreach (var ws in this.WebSockets)
        {
            if (ws != context)
                this.Send(ws, Encoding.UTF8.GetString(rxBuffer));
        }
    }
    /// &lt;summary&gt;
    /// Gets the name of the server.
    /// &lt;/summary&gt;
    /// &lt;value&gt;
    /// The name of the server.
    /// &lt;/value&gt;
    public override string ServerName
    {
        get { return &quot;Chat Server&quot;; }
    }
    /// &lt;summary&gt;
    /// Called when this WebSockets Server accepts a new WebSockets client.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;The context.&lt;/param&gt;
    protected override void OnClientConnected(WebSocketContext context)
    {
        this.Send(context, &quot;Welcome to the chat room!&quot;);
        foreach (var ws in this.WebSockets)
        {
            if (ws != context)
                this.Send(ws, &quot;Someone joined the chat room.&quot;);
        }
    }
    /// &lt;summary&gt;
    /// Called when this WebSockets Server receives a message frame regardless if the frame represents the EndOfMessage.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;The context.&lt;/param&gt;
    /// &lt;param name=&quot;rxBuffer&quot;&gt;The rx buffer.&lt;/param&gt;
    /// &lt;param name=&quot;rxResult&quot;&gt;The rx result.&lt;/param&gt;
    protected override void OnFrameReceived(WebSocketContext context, byte[] rxBuffer, WebSocketReceiveResult rxResult)
    {
        return;
    }
    /// &lt;summary&gt;
    /// Called when the server has removed a WebSockets connected client for any reason.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;The context.&lt;/param&gt;
    protected override void OnClientDisconnected(WebSocketContext context)
    {
        this.Broadcast(string.Format(&quot;Someone left the chat room.&quot;));
    }
}</code></pre>
                        <hr />
                        <h2 id="cli">EmbedIO CLI</h2>

                        Start any web folder or EmbedIO-enabled DLL from command line.
                        You can find <a href="https://github.com/unosquare/embedio/tree/master/Unosquare.Labs.EmbedIO.Command">EmbedIO CLI</a>.

                        <h3>Run web folder (static content only)</h3>

                        <pre><code>$ embediocli -p c:\wwwroot</code></pre>

                        <h3>Run web folder with WebAPI or WebSocket Assembly</h3>

                        <pre><code>$ embediocli -p c:\wwwroot --api mywebapi.dll</code></pre>
                    </section>
                </div>
                <footer>
                    Brought to you by Unosquare<br />
                    <a href="http://www.unosquare.com">
                        <img alt="unosquare" src="images/logo_178.png" />
                    </a>
                </footer>
            </div>
        </div>
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-8535255-2', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>
